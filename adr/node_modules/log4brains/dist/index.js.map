{"version":3,"file":"index.js","sources":["../src/cli.ts","../src/index.ts"],"sourcesContent":["import commander from \"commander\";\nimport type { AppConsole } from \"@log4brains/cli-common\";\nimport { createInitCli } from \"@log4brains/init\";\nimport { createCli } from \"@log4brains/cli\";\nimport { createWebCli } from \"@log4brains/web\";\n\ntype Deps = {\n  appConsole: AppConsole;\n  version: string;\n};\n\nexport function createGlobalCli({\n  appConsole,\n  version\n}: Deps): commander.Command {\n  const program = new commander.Command();\n  program\n    .version(version)\n    .description(\n      \"Log4brains CLI to preview and build your architecture knowledge base.\\n\" +\n        \"You can also manage your ADRs from here (see `log4brains adr --help`).\\n\\n\" +\n        \"All the commands should be run from your project's root folder.\\n\\n\" +\n        \"Add the `--help` option to any command to see its detailed documentation.\"\n    );\n\n  const initCli = createInitCli({ appConsole });\n  const cli = createCli({ appConsole });\n  const webCli = createWebCli({ appConsole });\n\n  [...initCli.commands, ...cli.commands, ...webCli.commands].forEach((cmd) => {\n    program.addCommand(cmd);\n  });\n\n  return program;\n}\n","import chalk from \"chalk\";\nimport { AppConsole, FailureExit } from \"@log4brains/cli-common\";\nimport { Log4brainsConfigNotFoundError } from \"@log4brains/core\";\nimport { createGlobalCli } from \"./cli\";\n\nconst debug = !!process.env.DEBUG;\nconst dev = process.env.NODE_ENV === \"development\";\nconst appConsole = new AppConsole({ debug, traces: debug || dev });\n\nfunction handleError(err: unknown): void {\n  if (appConsole.isSpinning()) {\n    appConsole.stopSpinner(true);\n  }\n\n  if (err instanceof FailureExit) {\n    process.exit(1);\n  }\n\n  if (err instanceof Log4brainsConfigNotFoundError) {\n    appConsole.fatal(`Cannot find ${chalk.bold(\".log4brains.yml\")}`);\n    appConsole.printlnErr(\n      chalk.red(\n        `You are in the wrong directory or you need to run ${chalk.cyan(\n          \"log4brains init\"\n        )}`\n      )\n    );\n    process.exit(1);\n  }\n\n  appConsole.fatal(err as Error);\n  process.exit(1);\n}\n\ntry {\n  // eslint-disable-next-line\n  const pkgVersion = require(\"../package.json\").version as string;\n\n  const cli = createGlobalCli({ version: pkgVersion, appConsole });\n  cli.parseAsync(process.argv).catch(handleError);\n} catch (e) {\n  handleError(e);\n}\n"],"names":["createGlobalCli","appConsole","version","program","commander","Command","description","initCli","createInitCli","cli","createCli","webCli","createWebCli","commands","forEach","cmd","addCommand","debug","process","env","DEBUG","dev","NODE_ENV","AppConsole","traces","handleError","err","isSpinning","stopSpinner","FailureExit","exit","Log4brainsConfigNotFoundError","fatal","chalk","bold","printlnErr","red","cyan","pkgVersion","require","parseAsync","argv","catch","e"],"mappings":";;;;;;;;;;SAWgBA,gBAAgB;AAC9BC,EAAAA,UAD8B;AAE9BC,EAAAA;AAF8B;AAI9B,QAAMC,OAAO,GAAG,IAAIC,SAAS,CAACC,OAAd,EAAhB;AACAF,EAAAA,OAAO,CACJD,OADH,CACWA,OADX,EAEGI,WAFH,CAGI,4EACE,4EADF,GAEE,qEAFF,GAGE,2EANN;AASA,QAAMC,OAAO,GAAGC,kBAAa,CAAC;AAAEP,IAAAA;AAAF,GAAD,CAA7B;AACA,QAAMQ,KAAG,GAAGC,aAAS,CAAC;AAAET,IAAAA;AAAF,GAAD,CAArB;AACA,QAAMU,MAAM,GAAGC,gBAAY,CAAC;AAAEX,IAAAA;AAAF,GAAD,CAA3B;AAEA,GAAC,GAAGM,OAAO,CAACM,QAAZ,EAAsB,GAAGJ,KAAG,CAACI,QAA7B,EAAuC,GAAGF,MAAM,CAACE,QAAjD,EAA2DC,OAA3D,CAAoEC,GAAD;AACjEZ,IAAAA,OAAO,CAACa,UAAR,CAAmBD,GAAnB;AACD,GAFD;AAIA,SAAOZ,OAAP;AACD;;AC7BD,MAAMc,KAAK,GAAG,CAAC,CAACC,OAAO,CAACC,GAAR,CAAYC,KAA5B;AACA,MAAMC,GAAG,GAAGH,OAAO,CAACC,GAAR,CAAYG,QAAZ,KAAyB,aAArC;AACA,MAAMrB,UAAU,GAAG,IAAIsB,oBAAJ,CAAe;AAAEN,EAAAA,KAAF;AAASO,EAAAA,MAAM,EAAEP,KAAK,IAAII;AAA1B,CAAf,CAAnB;;AAEA,SAASI,WAAT,CAAqBC,GAArB;AACE,MAAIzB,UAAU,CAAC0B,UAAX,EAAJ,EAA6B;AAC3B1B,IAAAA,UAAU,CAAC2B,WAAX,CAAuB,IAAvB;AACD;;AAED,MAAIF,GAAG,YAAYG,qBAAnB,EAAgC;AAC9BX,IAAAA,OAAO,CAACY,IAAR,CAAa,CAAb;AACD;;AAED,MAAIJ,GAAG,YAAYK,kCAAnB,EAAkD;AAChD9B,IAAAA,UAAU,CAAC+B,KAAX,gBAAgCC,KAAK,CAACC,IAAN,CAAW,iBAAX,GAAhC;AACAjC,IAAAA,UAAU,CAACkC,UAAX,CACEF,KAAK,CAACG,GAAN,sDACuDH,KAAK,CAACI,IAAN,CACnD,iBADmD,GADvD,CADF;AAOAnB,IAAAA,OAAO,CAACY,IAAR,CAAa,CAAb;AACD;;AAED7B,EAAAA,UAAU,CAAC+B,KAAX,CAAiBN,GAAjB;AACAR,EAAAA,OAAO,CAACY,IAAR,CAAa,CAAb;AACD;;AAED,IAAI;AACF;AACA,QAAMQ,UAAU,GAAGC,OAAO,CAAC,iBAAD,CAAP,CAA2BrC,OAA9C;;AAEA,QAAMO,GAAG,GAAGT,eAAe,CAAC;AAAEE,IAAAA,OAAO,EAAEoC,UAAX;AAAuBrC,IAAAA;AAAvB,GAAD,CAA3B;AACAQ,EAAAA,GAAG,CAAC+B,UAAJ,CAAetB,OAAO,CAACuB,IAAvB,EAA6BC,KAA7B,CAAmCjB,WAAnC;AACD,CAND,CAME,OAAOkB,CAAP,EAAU;AACVlB,EAAAA,WAAW,CAACkB,CAAD,CAAX;AACD"}